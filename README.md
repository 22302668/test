-- Version ANSI (LEFT JOIN) sans changer le résultat final
-- Reprend exactement la structure de ta requête, uniformisée avec syntaxe ANSI JOIN

WITH impayes_cte AS (
  SELECT 
    FRE.FREDOSID AS DOSID,
    NVL(SUM(F_PIFactImp(FAC.FACID, $P{DateRef})), 0) AS montant_impayes_ttc
  FROM FACREFERENCE FRE
  JOIN FACTURE FAC ON FRE.FACID = FAC.FACID
  JOIN ROLE R ON FAC.ROLCODE = R.ROLCODE
  WHERE R.ROLCODEEXTERNE IN ('CLIENT', 'GARANT')
  GROUP BY FRE.FREDOSID
),
indemnite_cte AS (
  SELECT 
    FRE.FREDOSID AS DOSID,
    NVL(SUM(F_PlFact_Imp(FAC.FACID, $P{DateRef})), 0) AS indemnite
  FROM FACREFERENCE FRE
  JOIN FACTURE FAC ON FRE.FACID = FAC.FACID
  JOIN FACLIGNE FL ON FL.FACID = FAC.FACID
  JOIN RUBRIQUE RUB ON FL.RUBID = RUB.RUBID
  JOIN ROLE R ON FAC.ROLCODE = R.ROLCODE
  WHERE RUB.UGECODE = $P{UniteGestion}
    AND FAC.FACIDORIGINE IS NULL
    AND FAC.FACFLAGAVOIR IS NULL
    AND R.ROLCODEEXTERNE IN ('CLIENT', 'GARANT')
    AND RUB.RUBCODE = 'INDRES'
  GROUP BY FRE.FREDOSID
)
SELECT ... -- ici vient le SELECT complet
FROM DOSSIER
JOIN SOCIETE ON SOCIETE.ACTID = DOSSIER.ACTID
JOIN ACTEURGESTION ON ACTEURGESTION.ACTID = SOCIETE.ACTID
JOIN UTILISATEUR UTILISATEUR_DOSSIER ON UTILISATEUR_DOSSIER.UGECODE = SOCIETE.UGECODE AND UTILISATEUR_DOSSIER.BOLOGIN = $P{Utilisateur}
JOIN LANTACTIVITE ON LANTACTIVITE.TACCODE = DOSSIER.TACCODE
JOIN LANTPROFILGESTION ON LANTPROFILGESTION.TPGCODE = DOSSIER.TPGCODE
JOIN DOSPHASE ON DOSPHASE.DOSID = DOSSIER.DOSID
JOIN LANJALON ON LANJALON.JALCODE = DOSPHASE.JALCODE
JOIN LANPHASE ON LANPHASE.PHACODE = DOSPHASE.PHACODE AND LANPHASE.PHADEST = DOSPHASE.PHADEST
JOIN DOSACTEUR ON DOSACTEUR.DOSID = DOSSIER.DOSID
JOIN ACTEUR GARANT ON GARANT.ACTID = DOSACTEUR.ACTID
JOIN LANROLE ON LANROLE.ROLCODE = DOSACTEUR.ROLCODE
JOIN DOSACTGARANTIE ON DOSACTGARANTIE.DOSID = DOSACTEUR.DOSID AND DOSACTGARANTIE.DACORDRE = DOSACTEUR.DACORDRE
JOIN LANTGARANTIE ON LANTGARANTIE.TGACODE = DOSACTGARANTIE.TACODE
JOIN LANPHASE LANPHASE_GARANTIE ON LANPHASE_GARANTIE.PHACODE = DOSACTGARANTIE.PHACODE AND LANPHASE_GARANTIE.PHADEST = 'DOSSIER'
LEFT JOIN ACTADRESSE ON ACTADRESSE.ACTID = GARANT.ACTID
  AND ACTADRESSE.AADFLAGSIEGE = 1
  AND ACTADRESSE.AADDTREMPLACE IS NULL
  AND ACTADRESSE.AADORDRE = (
    SELECT MAX(aadordre)
    FROM ACTADRESSE adr2
    WHERE adr2.actid = ACTADRESSE.actid
      AND adr2.aadflagsiege = 1
      AND adr2.aaddtremplace IS NULL
  )
LEFT JOIN ADRESSE ON ADRESSE.ADRID = ACTADRESSE.ADRID
LEFT JOIN impayes_cte ic ON ic.DOSID = DOSSIER.DOSID
LEFT JOIN indemnite_cte ind ON ind.DOSID = DOSSIER.DOSID
WHERE DOSPHASE.JALCODE NOT IN ('ARCEC', 'ARC')
  AND UTILISATEUR_DOSSIER.UGECODE = $P{UniteGestion}
  AND SOCIETE.ACTNOM <> 'GENEFIMMO'
  AND LANROLE.ROLCODE IN ('TIEASSU', 'AGGARHG', 'GARANT', 'CAUTION', 'AGENCE')
  AND DOSACTEUR.DACDTDEB < TO_DATE(REPLACE($P{DateRef}, ' 00:00:00', ''), 'DD/MM/YYYY')
  AND (DOSACTEUR.DACDTFIN IS NULL OR DOSACTEUR.DACDTFIN > TO_DATE(REPLACE($P{DateRef}, ' 00:00:00', ''), 'DD/MM/YYYY'))
  AND DOSPHASE.DPHDTEFFET <= TO_DATE(REPLACE($P{DateRef}, ' 00:00:00', ''), 'DD/MM/YYYY')
  AND (DOSPHASE.DPHDTFIN IS NULL OR DOSPHASE.DPHDTFIN >= TO_DATE(REPLACE($P{DateRef}, ' 00:00:00', ''), 'DD/MM/YYYY'))
  AND LANJALON.LANCODE = 'FR'
  AND LANPHASE.LANCODE = 'FR'
  AND LANTPROFILGESTION.LANCODE = 'FR'
  AND LANTACTIVITE.LANCODE = 'FR'
  AND LANROLE.LANCODE = 'FR'
  AND LANTGARANTIE.LANCODE = 'FR'
  AND LANPHASE_GARANTIE.LANCODE = 'FR'
